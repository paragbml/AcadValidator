{% extends "base.html" %}

{% block title %}Risk Assessment - UGC-AICTE Portal{% endblock %}

{% block extra_css %}
<style>
.risk-dashboard {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    min-height: 100vh;
    padding: 20px 0;
}

.risk-header {
    background: rgba(255,255,255,0.95);
    border-radius: 15px;
    padding: 30px;
    margin-bottom: 30px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    backdrop-filter: blur(10px);
}

.risk-card {
    background: white;
    border-radius: 15px;
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
}

.risk-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

.risk-level {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 10px;
}

.risk-high { color: #dc3545; }
.risk-medium { color: #ffc107; }
.risk-low { color: #28a745; }

.risk-indicator {
    width: 15px;
    height: 15px;
    border-radius: 50%;
    display: inline-block;
    margin-right: 8px;
}

.ai-badge {
    background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
    color: white;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.risk-matrix {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin: 20px 0;
}

.matrix-cell {
    aspect-ratio: 1;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
    font-size: 0.9rem;
}

.risk-critical { background: #8b0000; }
.risk-major { background: #dc3545; }
.risk-moderate { background: #ffc107; color: #000; }
.risk-minor { background: #28a745; }
.risk-minimal { background: #20c997; }
</style>
{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{{ url_for('index') }}">Dashboard</a></li>
<li class="breadcrumb-item active" aria-current="page">Risk Assessment</li>
{% endblock %}

{% block content %}
<div class="risk-dashboard">
    <div class="container-fluid">
        <!-- Header -->
        <div class="risk-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-3">
                        <i class="bi bi-exclamation-triangle text-warning"></i>
                        Institutional Risk Assessment
                    </h1>
                    <p class="lead mb-0">Comprehensive AI-powered risk analysis for proactive institutional management</p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="ai-badge">
                        <i class="bi bi-shield-exclamation"></i>
                        <span>Risk Analytics</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Overall Risk Score -->
            <div class="col-lg-4 mb-4">
                <div class="risk-card text-center">
                    <h4 class="text-dark mb-4">Overall Risk Level</h4>
                    <div class="risk-level risk-medium">MEDIUM</div>
                    <div class="risk-score mb-4">
                        <span style="font-size: 2rem; color: #ffc107;">6.2</span>
                        <span class="text-muted">/10</span>
                    </div>
                    <canvas id="riskGauge" width="200" height="200"></canvas>
                    <div class="mt-3">
                        <span class="badge bg-warning text-dark fs-6">Moderate Risk</span>
                    </div>
                </div>
            </div>

            <!-- Risk Categories -->
            <div class="col-lg-8 mb-4">
                <div class="risk-card">
                    <h4 class="text-dark mb-4">Risk Categories</h4>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="risk-category-item p-3 border rounded">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="risk-indicator risk-high"></span>
                                    <h6 class="mb-0">Financial Risk</h6>
                                    <span class="ms-auto badge bg-danger">High</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-danger" style="width: 78%"></div>
                                </div>
                                <small class="text-muted">7.8/10 - Revenue dependency concerns</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="risk-category-item p-3 border rounded">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="risk-indicator risk-medium"></span>
                                    <h6 class="mb-0">Academic Risk</h6>
                                    <span class="ms-auto badge bg-warning text-dark">Medium</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-warning" style="width: 55%"></div>
                                </div>
                                <small class="text-muted">5.5/10 - Faculty shortage in key areas</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="risk-category-item p-3 border rounded">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="risk-indicator risk-low"></span>
                                    <h6 class="mb-0">Compliance Risk</h6>
                                    <span class="ms-auto badge bg-success">Low</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-success" style="width: 25%"></div>
                                </div>
                                <small class="text-muted">2.5/10 - Good regulatory compliance</small>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="risk-category-item p-3 border rounded">
                                <div class="d-flex align-items-center mb-2">
                                    <span class="risk-indicator risk-medium"></span>
                                    <h6 class="mb-0">Operational Risk</h6>
                                    <span class="ms-auto badge bg-warning text-dark">Medium</span>
                                </div>
                                <div class="progress mb-2">
                                    <div class="progress-bar bg-warning" style="width: 62%"></div>
                                </div>
                                <small class="text-muted">6.2/10 - Infrastructure aging concerns</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Risk Matrix -->
            <div class="col-lg-6 mb-4">
                <div class="risk-card">
                    <h4 class="text-dark mb-4">Risk Impact Matrix</h4>
                    <div class="risk-matrix">
                        <div class="matrix-cell risk-moderate">Medium</div>
                        <div class="matrix-cell risk-major">High</div>
                        <div class="matrix-cell risk-critical">Critical</div>
                        <div class="matrix-cell risk-minor">Low</div>
                        <div class="matrix-cell risk-moderate">Medium</div>
                        <div class="matrix-cell risk-major">High</div>
                        <div class="matrix-cell risk-minimal">Minimal</div>
                        <div class="matrix-cell risk-minor">Low</div>
                        <div class="matrix-cell risk-moderate">Medium</div>
                    </div>
                    <div class="mt-3">
                        <small class="text-muted">
                            <strong>X-axis:</strong> Probability &nbsp;&nbsp;
                            <strong>Y-axis:</strong> Impact
                        </small>
                    </div>
                </div>
            </div>

            <!-- Risk Trends -->
            <div class="col-lg-6 mb-4">
                <div class="risk-card">
                    <h4 class="text-dark mb-4">Risk Trends</h4>
                    <canvas id="riskTrendChart" width="400" height="250"></canvas>
                </div>
            </div>

            <!-- Risk Mitigation Plan -->
            <div class="col-12 mb-4">
                <div class="risk-card">
                    <h4 class="text-dark mb-4">
                        <i class="bi bi-shield-check text-success"></i>
                        Risk Mitigation Plan
                    </h4>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="mitigation-item p-3 border-start border-danger border-4 bg-light h-100">
                                <h6 class="text-danger mb-2">Immediate Actions (0-30 days)</h6>
                                <ul class="list-unstyled mb-0">
                                    <li><i class="bi bi-clock text-danger me-2"></i>Diversify revenue streams</li>
                                    <li><i class="bi bi-clock text-danger me-2"></i>Emergency fund allocation</li>
                                    <li><i class="bi bi-clock text-danger me-2"></i>Crisis management protocol</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="mitigation-item p-3 border-start border-warning border-4 bg-light h-100">
                                <h6 class="text-warning mb-2">Short-term (1-6 months)</h6>
                                <ul class="list-unstyled mb-0">
                                    <li><i class="bi bi-calendar text-warning me-2"></i>Faculty recruitment drive</li>
                                    <li><i class="bi bi-calendar text-warning me-2"></i>Infrastructure maintenance</li>
                                    <li><i class="bi bi-calendar text-warning me-2"></i>Student retention programs</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="mitigation-item p-3 border-start border-success border-4 bg-light h-100">
                                <h6 class="text-success mb-2">Long-term (6+ months)</h6>
                                <ul class="list-unstyled mb-0">
                                    <li><i class="bi bi-graph-up text-success me-2"></i>Strategic partnerships</li>
                                    <li><i class="bi bi-graph-up text-success me-2"></i>Digital transformation</li>
                                    <li><i class="bi bi-graph-up text-success me-2"></i>Research enhancement</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Recommendations -->
            <div class="col-12">
                <div class="risk-card">
                    <h4 class="text-dark mb-4">
                        <i class="bi bi-robot text-primary"></i>
                        AI Risk Recommendations
                    </h4>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="recommendation-item p-3 bg-light rounded mb-3">
                                <h6 class="text-primary">Predictive Analysis</h6>
                                <p class="text-muted mb-0">Current trajectory indicates 15% risk increase over next 6 months without intervention</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="recommendation-item p-3 bg-light rounded mb-3">
                                <h6 class="text-success">Success Probability</h6>
                                <p class="text-muted mb-0">Implementation of mitigation plan shows 78% probability of risk reduction to acceptable levels</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Risk Gauge Chart
    const gaugeCtx = document.getElementById('riskGauge').getContext('2d');
    new Chart(gaugeCtx, {
        type: 'doughnut',
        data: {
            datasets: [{
                data: [62, 38],
                backgroundColor: ['#ffc107', '#e9ecef'],
                borderWidth: 0,
                cutout: '70%'
            }]
        },
        options: {
            responsive: false,
            plugins: { legend: { display: false } }
        }
    });

    // Risk Trend Chart
    const trendCtx = document.getElementById('riskTrendChart').getContext('2d');
    new Chart(trendCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Risk Level',
                data: [5.8, 6.1, 6.5, 6.8, 6.4, 6.2],
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: false, min: 5, max: 8 }
            }
        }
    });
});
</script>
{% endblock %}